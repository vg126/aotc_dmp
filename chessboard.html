<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive React Chessboard (v2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <style>
        /* Centering the board for better presentation */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #111827; /* bg-gray-900 */
            font-family: sans-serif;
        }
        .square {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 36px; /* Larger pieces */
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .selected {
            background-color: #facc15; /* yellow-400 for selection */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        /**
         * Interactive Chessboard Component (v2 - Patched)
         * Renders an 8x8 chessboard with fixed click-to-move logic.
         * Clicking a selected piece now deselects it.
         */
        const Chessboard = () => {
          const boardSize = 8;

          const initialBoardState = [
            ['r', 'n', 'b', 'q', 'k', 'b', 'n', 'r'],
            ['p', 'p', 'p', 'p', 'p', 'p', 'p', 'p'],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null],
            ['P', 'P', 'P', 'P', 'P', 'P', 'P', 'P'],
            ['R', 'N', 'B', 'Q', 'K', 'B', 'N', 'R'],
          ];
          
          const [board, setBoard] = React.useState(initialBoardState);
          const [selectedSquare, setSelectedSquare] = React.useState(null);

          const pieceSVGs = {
            'p': '♟', 'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚',
            'P': '♙', 'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔'
          };

          // Handles clicks on squares
          const handleSquareClick = (row, col) => {
            if (selectedSquare) {
              // A piece is selected. Check if it's the same square.
              if (selectedSquare.row === row && selectedSquare.col === col) {
                // Clicked the same square again: DESELECT the piece.
                setSelectedSquare(null);
                return; // Exit without moving.
              }

              // It's a different square: MOVE the piece.
              const newBoard = [...board.map(r => [...r])];
              const piece = newBoard[selectedSquare.row][selectedSquare.col];

              newBoard[row][col] = piece;
              newBoard[selectedSquare.row][selectedSquare.col] = null;
              
              setBoard(newBoard);
              setSelectedSquare(null); // Deselect after moving.
            } else {
              // No piece is selected: SELECT one.
              if (board[row][col]) {
                setSelectedSquare({ row, col });
              }
            }
          };

          const renderPiece = (piece) => {
            if (!piece) return null;
            const isWhite = piece === piece.toUpperCase();
            const color = isWhite ? 'text-white' : 'text-gray-800';
            return React.createElement('span', { className: color, style: { textShadow: '0 0 5px rgba(0,0,0,0.3)' } }, pieceSVGs[piece]);
          };

          const renderSquare = (row, col) => {
            const isLightSquare = (row + col) % 2 === 0;
            let squareColor = isLightSquare ? 'bg-gray-200' : 'bg-gray-600';
            const piece = board[row][col];
            const isSelected = selectedSquare && selectedSquare.row === row && selectedSquare.col === col;

            return React.createElement(
              'div',
              {
                key: `square-${row}-${col}`,
                className: `w-16 h-16 ${squareColor} square ${isSelected ? 'selected' : ''}`,
                onClick: () => handleSquareClick(row, col),
              },
              renderPiece(piece)
            );
          };

          const renderRow = (row) => {
            return React.createElement(
              'div',
              { key: `row-${row}`, className: 'flex' },
              Array(boardSize).fill(0).map((_, col) => renderSquare(row, col))
            );
          };

          return React.createElement(
            'div',
            { className: 'inline-block border-4 border-gray-800 rounded-md shadow-lg' },
            Array(boardSize).fill(0).map((_, row) => renderRow(row))
          );
        };

        document.addEventListener('DOMContentLoaded', () => {
          const root = ReactDOM.createRoot(document.getElementById('root'));
          root.render(React.createElement(Chessboard));
        });
    </script>
</body>
</html>
